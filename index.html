<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImageMetrics Tool - Ø£Ø¯Ø§Ø© Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„ØµÙˆØ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f4ebe1 0%, #e8d5c4 100%);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #d97757 0%, #cc6244 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .lang-switch {
            position: absolute;
            top: 30px;
            left: 30px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        [dir="ltr"] .lang-switch {
            left: auto;
            right: 30px;
        }

        .lang-switch:hover {
            background: white;
            color: #d97757;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            padding: 30px;
        }

        .canvas-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .upload-zone {
            border: 3px dashed #d97757;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            background: #fef9f5;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-zone:hover {
            background: #fef5ee;
            border-color: #cc6244;
        }

        .upload-zone.dragover {
            background: #fee8dd;
            border-color: #cc6244;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .canvas-container {
            position: relative;
            border: 2px solid #ddd;
            border-radius: 10px;
            overflow: auto;
            background: #f5f5f5;
            display: none;
            max-height: 600px;
        }

        .canvas-container.active {
            display: block;
        }

        canvas {
            display: block;
            cursor: crosshair;
        }

        canvas.dragging {
            cursor: grab;
        }

        canvas.grabbing {
            cursor: grabbing;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            padding: 20px;
            background: #fef9f5;
            border-radius: 10px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #d97757 0%, #cc6244 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(217, 119, 87, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .info-panel {
            background: #fef9f5;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #d97757;
        }

        .info-panel h3 {
            color: #d97757;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .coord-display {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .coord-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-family: 'Courier New', monospace;
        }

        .coord-label {
            font-weight: bold;
            color: #d97757;
        }

        .points-list {
            max-height: 300px;
            overflow-y: auto;
            background: white;
            padding: 10px;
            border-radius: 8px;
        }

        .point-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: #fef9f5;
            border-radius: 5px;
            border-left: 4px solid;
        }

        .point-item:nth-child(odd) { border-color: #d97757; }
        .point-item:nth-child(even) { border-color: #cc6244; }

        .delete-point {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 5px;
            border: 2px solid #ddd;
            display: inline-block;
            vertical-align: middle;
            margin-left: 10px;
        }

        [dir="ltr"] .color-preview {
            margin-left: 0;
            margin-right: 10px;
        }

        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .zoom-controls input[type="range"] {
            flex: 1;
        }

        .distance-display {
            background: #ffe66d;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-weight: bold;
            text-align: center;
            display: none;
        }

        .distance-display.active {
            display: block;
        }

        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 0.9em;
        }

        .footer a {
            color: #d97757;
            text-decoration: none;
        }

        .instructions {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #ffc107;
            margin-bottom: 20px;
        }

        .instructions h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .instructions ul {
            margin-right: 20px;
            color: #856404;
        }

        [dir="ltr"] .instructions ul {
            margin-right: 0;
            margin-left: 20px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="lang-switch" onclick="toggleLanguage()">English</button>
            <h1 id="mainTitle">ImageMetrics Tool</h1>
            <p id="subtitle">Ø£Ø¯Ø§Ø© Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„ØµÙˆØ± - Ù‚ÙŠØ§Ø³ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø³Ø§ÙØ§Øª Ø¨Ø¯Ù‚Ø©</p>
        </div>

        <div class="main-content">
            <div class="canvas-area">
                <div class="instructions">
                    <h4 id="instrTitle">ğŸ“‹ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</h4>
                    <ul id="instrList">
                        <li>Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¨Ø§Ù„Ù†Ù‚Ø± Ø£Ùˆ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª</li>
                        <li>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ù„Ø­ÙØ¸ Ù†Ù‚Ø·Ø© ÙˆØ¥Ø­Ø¯Ø§Ø«ÙŠØ§ØªÙ‡Ø§</li>
                        <li>Ø­Ø±Ùƒ Ø§Ù„ÙØ£Ø±Ø© Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø­ÙŠØ©</li>
                        <li>Ø§Ø®ØªØ± Ù†Ù‚Ø·ØªÙŠÙ† Ù„Ù‚ÙŠØ§Ø³ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ†Ù‡Ù…Ø§</li>
                        <li>Ø§Ø¶ØºØ· Shift + Ø§Ø³Ø­Ø¨ Ù„Ù„ØªØ¬ÙˆÙ„ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ÙƒØ¨Ø±Ø©</li>
                        <li>ØµØ¯Ù‘Ø± Ø§Ù„Ù†Ù‚Ø§Ø· Ø¥Ù„Ù‰ Ù…Ù„Ù CSV</li>
                    </ul>
                </div>

                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">ğŸ“</div>
                    <h2 id="uploadTitle">Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§</h2>
                    <p id="uploadText">Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ</p>
                    <input type="file" id="fileInput" accept="image/*" style="display:none;">
                </div>

                <div class="canvas-container" id="canvasContainer">
                    <canvas id="mainCanvas"></canvas>
                </div>

                <div class="controls">
                    <button class="btn-primary" onclick="document.getElementById('fileInput').click()" id="btnNewImage">ğŸ“ ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                    <button class="btn-primary" onclick="exportToCSV()" id="btnExport">ğŸ’¾ ØªØµØ¯ÙŠØ± CSV</button>
                    <button class="btn-danger" onclick="clearAllPoints()" id="btnClear">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
                    
                    <label class="checkbox-label">
                        <input type="checkbox" id="gridToggle" onchange="toggleGrid()">
                        <span id="gridLabel">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø¨ÙƒØ©</span>
                    </label>

                    <div class="zoom-controls">
                        <span id="zoomLabel">ØªÙƒØ¨ÙŠØ±:</span>
                        <input type="range" id="zoomSlider" min="100" max="300" value="100" oninput="updateZoom(this.value)">
                        <span id="zoomValue">100%</span>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="info-panel">
                    <h3 id="liveCoordTitle">ğŸ“ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø­ÙŠØ©</h3>
                    <div class="coord-display">
                        <div class="coord-item">
                            <span class="coord-label">X:</span>
                            <span id="liveX">-</span>
                        </div>
                        <div class="coord-item">
                            <span class="coord-label">Y:</span>
                            <span id="liveY">-</span>
                        </div>
                        <div class="coord-item">
                            <span class="coord-label">RGB:</span>
                            <span id="liveRGB">-</span>
                        </div>
                        <div class="coord-item">
                            <span class="coord-label">HEX:</span>
                            <span id="liveHEX">-</span>
                            <span class="color-preview" id="colorPreview"></span>
                        </div>
                    </div>
                </div>

                <div class="info-panel">
                    <h3 id="savedPointsTitle">ğŸ“Œ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h3>
                    <div class="points-list" id="pointsList">
                        <p id="noPoints" style="text-align:center;color:#999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ù‚Ø§Ø· Ù…Ø­ÙÙˆØ¸Ø©</p>
                    </div>
                    <div class="distance-display" id="distanceDisplay">
                        <span id="distanceLabel">Ø§Ù„Ù…Ø³Ø§ÙØ©:</span> <span id="distanceValue">0</span> px
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>ØªØ·ÙˆÙŠØ±: Ø¹Ø¨Ø¯Ø§Ù„ÙƒØ±ÙŠÙ… Ø§Ù„Ø¹Ø¨ÙˆØ¯ | <a href="mailto:abo.saleh.g@gmail.com">abo.saleh.g@gmail.com</a></p>
            <p>Â© 2024 ImageMetrics Tool - All Rights Reserved</p>
        </div>
    </div>

    <script>
        let currentLang = 'ar';
        const translations = {
            ar: {
                mainTitle: 'ImageMetrics Tool',
                subtitle: 'Ø£Ø¯Ø§Ø© Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„ØµÙˆØ± - Ù‚ÙŠØ§Ø³ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø³Ø§ÙØ§Øª Ø¨Ø¯Ù‚Ø©',
                instrTitle: 'ğŸ“‹ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:',
                instrList: [
                    'Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¨Ø§Ù„Ù†Ù‚Ø± Ø£Ùˆ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª',
                    'Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ù„Ø­ÙØ¸ Ù†Ù‚Ø·Ø© ÙˆØ¥Ø­Ø¯Ø§Ø«ÙŠØ§ØªÙ‡Ø§',
                    'Ø­Ø±Ùƒ Ø§Ù„ÙØ£Ø±Ø© Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø­ÙŠØ©',
                    'Ø§Ø®ØªØ± Ù†Ù‚Ø·ØªÙŠÙ† Ù„Ù‚ÙŠØ§Ø³ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ†Ù‡Ù…Ø§',
                    'ØµØ¯Ù‘Ø± Ø§Ù„Ù†Ù‚Ø§Ø· Ø¥Ù„Ù‰ Ù…Ù„Ù CSV'
                ],
                uploadTitle: 'Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§',
                uploadText: 'Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ',
                btnNewImage: 'ğŸ“ ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©',
                btnExport: 'ğŸ’¾ ØªØµØ¯ÙŠØ± CSV',
                btnClear: 'ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„',
                gridLabel: 'Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø¨ÙƒØ©',
                zoomLabel: 'ØªÙƒØ¨ÙŠØ±:',
                liveCoordTitle: 'ğŸ“ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø­ÙŠØ©',
                savedPointsTitle: 'ğŸ“Œ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©',
                noPoints: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ù‚Ø§Ø· Ù…Ø­ÙÙˆØ¸Ø©',
                distanceLabel: 'Ø§Ù„Ù…Ø³Ø§ÙØ©:',
                point: 'Ù†Ù‚Ø·Ø©'
            },
            en: {
                mainTitle: 'ImageMetrics Tool',
                subtitle: 'Image Measurement Tool - Precise Coordinates and Distance Measurement',
                instrTitle: 'ğŸ“‹ Instructions:',
                instrList: [
                    'Upload an image by clicking or drag & drop',
                    'Click on the image to save a point and its coordinates',
                    'Move mouse to see live coordinates',
                    'Select two points to measure distance',
                    'Export points to CSV file'
                ],
                uploadTitle: 'Drag & Drop Image Here',
                uploadText: 'Or click to select from your device',
                btnNewImage: 'ğŸ“ New Image',
                btnExport: 'ğŸ’¾ Export CSV',
                btnClear: 'ğŸ—‘ï¸ Clear All',
                gridLabel: 'Show Grid',
                zoomLabel: 'Zoom:',
                liveCoordTitle: 'ğŸ“ Live Coordinates',
                savedPointsTitle: 'ğŸ“Œ Saved Points',
                noPoints: 'No saved points',
                distanceLabel: 'Distance:',
                point: 'Point'
            }
        };

        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const canvasContainer = document.getElementById('canvasContainer');
        let img = null;
        let points = [];
        let showGrid = false;
        let zoom = 1;
        let isDragging = false;
        let startX, startY, scrollLeft, scrollTop;
        const colors = ['#d97757', '#cc6244', '#b85739', '#a34d30', '#8f4427', '#7a3b1f', '#663218'];

        // Upload handlers
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');

        uploadZone.addEventListener('click', () => fileInput.click());
        
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                loadImage(file);
            }
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) loadImage(file);
        });

        function loadImage(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                img = new Image();
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    document.getElementById('canvasContainer').classList.add('active');
                    points = [];
                    zoom = 1;
                    document.getElementById('zoomSlider').value = 100;
                    document.getElementById('zoomValue').textContent = '100%';
                    renderCanvas();
                    updatePointsList();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function renderCanvas() {
            if (!img) return;
            
            // Set canvas size based on zoom
            canvas.width = img.width * zoom;
            canvas.height = img.height * zoom;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

            if (showGrid) {
                drawGrid();
            }

            points.forEach((point, idx) => {
                drawPoint(point.x * zoom, point.y * zoom, colors[idx % colors.length], idx + 1);
            });
        }

        function drawGrid() {
            const gridSize = 50 * zoom;
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 1;

            for (let x = 0; x < canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }

            for (let y = 0; y < canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }

        function drawPoint(x, y, color, number) {
            const radius = 8 * zoom;
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 2 * zoom;
            ctx.stroke();

            ctx.fillStyle = 'white';
            ctx.font = `bold ${12 * zoom}px Arial`;
            ctx.textAlign = 'center';
            ctx.fillText(number, x, y + (4 * zoom));
        }

        // Canvas drag to pan when zoomed
        canvas.addEventListener('mousedown', (e) => {
            if (zoom > 1 && e.button === 0 && e.shiftKey) {
                isDragging = true;
                canvas.classList.add('grabbing');
                startX = e.pageX - canvasContainer.offsetLeft;
                startY = e.pageY - canvasContainer.offsetTop;
                scrollLeft = canvasContainer.scrollLeft;
                scrollTop = canvasContainer.scrollTop;
                e.preventDefault();
            }
        });

        canvasContainer.addEventListener('mousemove', (e) => {
            if (isDragging) {
                e.preventDefault();
                const x = e.pageX - canvasContainer.offsetLeft;
                const y = e.pageY - canvasContainer.offsetTop;
                const walkX = (x - startX);
                const walkY = (y - startY);
                canvasContainer.scrollLeft = scrollLeft - walkX;
                canvasContainer.scrollTop = scrollTop - walkY;
            }
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                canvas.classList.remove('grabbing');
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!img || isDragging) return;
            const rect = canvas.getBoundingClientRect();
            const x = Math.round((e.clientX - rect.left) / zoom);
            const y = Math.round((e.clientY - rect.top) / zoom);

            document.getElementById('liveX').textContent = x;
            document.getElementById('liveY').textContent = y;

            const imgData = ctx.getImageData(e.clientX - rect.left, e.clientY - rect.top, 1, 1);
            const pixel = imgData.data;
            const rgb = `rgb(${pixel[0]}, ${pixel[1]}, ${pixel[2]})`;
            const hex = '#' + [pixel[0], pixel[1], pixel[2]].map(x => x.toString(16).padStart(2, '0')).join('');
            
            document.getElementById('liveRGB').textContent = rgb;
            document.getElementById('liveHEX').textContent = hex;
            document.getElementById('colorPreview').style.background = hex;
        });

        canvas.addEventListener('click', (e) => {
            if (!img || isDragging) return;
            const rect = canvas.getBoundingClientRect();
            const x = Math.round((e.clientX - rect.left) / zoom);
            const y = Math.round((e.clientY - rect.top) / zoom);

            const imgData = ctx.getImageData(e.clientX - rect.left, e.clientY - rect.top, 1, 1);
            const pixel = imgData.data;
            const hex = '#' + [pixel[0], pixel[1], pixel[2]].map(x => x.toString(16).padStart(2, '0')).join('');

            points.push({ x, y, color: hex });
            renderCanvas();
            updatePointsList();
            calculateDistance();
        });

        function updatePointsList() {
            const list = document.getElementById('pointsList');
            const noPoints = document.getElementById('noPoints');
            
            if (points.length === 0) {
                list.innerHTML = '<p id="noPoints" style="text-align:center;color:#999;">' + translations[currentLang].noPoints + '</p>';
                return;
            }
            
            list.innerHTML = '';
            
            points.forEach((point, idx) => {
                const div = document.createElement('div');
                div.className = 'point-item';
                div.innerHTML = `
                    <div>
                        <strong>${translations[currentLang].point} ${idx + 1}</strong><br>
                        X: ${point.x}, Y: ${point.y}<br>
                        <small>${point.color}</small>
                    </div>
                    <button class="delete-point" onclick="deletePoint(${idx})">âŒ</button>
                `;
                list.appendChild(div);
            });
        }

        function deletePoint(idx) {
            points.splice(idx, 1);
            renderCanvas();
            updatePointsList();
            calculateDistance();
        }

        function clearAllPoints() {
            if (confirm(currentLang === 'ar' ? 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·ØŸ' : 'Delete all points?')) {
                points = [];
                renderCanvas();
                updatePointsList();
                document.getElementById('distanceDisplay').classList.remove('active');
            }
        }

        function calculateDistance() {
            if (points.length >= 2) {
                const p1 = points[points.length - 2];
                const p2 = points[points.length - 1];
                const distance = Math.round(Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2)));
                document.getElementById('distanceValue').textContent = distance;
                document.getElementById('distanceDisplay').classList.add('active');
            } else {
                document.getElementById('distanceDisplay').classList.remove('active');
            }
        }

        function exportToCSV() {
            if (points.length === 0) {
                alert(currentLang === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ù‚Ø§Ø· Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§' : 'No points to export');
                return;
            }

            let csv = 'Point,X,Y,Color\n';
            points.forEach((point, idx) => {
                csv += `${idx + 1},${point.x},${point.y},${point.color}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'image_coordinates.csv';
            a.click();
        }

        function toggleGrid() {
            showGrid = document.getElementById('gridToggle').checked;
            renderCanvas();
        }

        function updateZoom(value) {
            zoom = value / 100;
            document.getElementById('zoomValue').textContent = value + '%';
            renderCanvas();
        }

        function toggleLanguage() {
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            document.documentElement.lang = currentLang;
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            
            document.querySelector('.lang-switch').textContent = currentLang === 'ar' ? 'English' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
            
            const t = translations[currentLang];
            document.getElementById('mainTitle').textContent = t.mainTitle;
            document.getElementById('subtitle').textContent = t.subtitle;
            document.getElementById('instrTitle').textContent = t.instrTitle;
            
            const instrList = document.getElementById('instrList');
            instrList.innerHTML = '';
            t.instrList.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                instrList.appendChild(li);
            });
            
            document.getElementById('uploadTitle').textContent = t.uploadTitle;
            document.getElementById('uploadText').textContent = t.uploadText;
            document.getElementById('btnNewImage').textContent = t.btnNewImage;
            document.getElementById('btnExport').textContent = t.btnExport;
            document.getElementById('btnClear').textContent = t.btnClear;
            document.getElementById('gridLabel').textContent = t.gridLabel;
            document.getElementById('zoomLabel').textContent = t.zoomLabel;
            document.getElementById('liveCoordTitle').textContent = t.liveCoordTitle;
            document.getElementById('savedPointsTitle').textContent = t.savedPointsTitle;
            document.getElementById('noPoints').textContent = t.noPoints;
            document.getElementById('distanceLabel').textContent = t.distanceLabel;
            
            updatePointsList();
        }
    </script>
</body>
</html>
